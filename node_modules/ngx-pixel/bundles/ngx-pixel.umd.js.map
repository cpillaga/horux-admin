{"version":3,"file":"ngx-pixel.umd.js","sources":["../../projects/pixel/src/lib/pixel.service.ts","../../projects/pixel/src/lib/pixel.module.ts","../../../projects/pixel/src/ngx-pixel.ts"],"sourcesContent":["import { PixelEventName, PixelConfiguration, PixelEventProperties } from './pixel.models';\nimport { Inject, Injectable, Optional, PLATFORM_ID, Renderer2, RendererFactory2 } from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { DOCUMENT, isPlatformBrowser } from '@angular/common';\nimport { filter } from 'rxjs/operators';\n\ndeclare const fbq: any;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PixelService {\n\n  private doc: Document;\n  private renderer: Renderer2\n\n  constructor(\n    @Inject('config') private config: PixelConfiguration,\n    @Inject(DOCUMENT) private injectedDocument: any,\n    @Inject(PLATFORM_ID) private platformId: Object,\n    @Optional() private router: Router,\n    private rendererFactory: RendererFactory2\n  ) {\n\n    // DOCUMENT cannot be injected directly as Document type, see https://github.com/angular/angular/issues/20351\n    // It is therefore injected as any and then cast to Document\n    this.doc = injectedDocument as Document;\n    this.renderer = rendererFactory.createRenderer(null, null);\n\n    if (router) {\n      // Log page views after router navigation ends\n      router.events.pipe(filter(event => event instanceof NavigationEnd)).subscribe(event => {\n\n        if (this.isLoaded()) {\n          this.track('PageView');\n        }\n\n      });\n    }\n\n  }\n\n  /**\n   * Initialize the Pixel tracking script\n   * - Adds the script to page's head\n   * - Tracks first page view\n   */\n  initialize(pixelId = this.config.pixelId): void {\n    if (this.isLoaded()) {\n      console.warn('Tried to initialize a Pixel instance while another is already active. Please call `remove()` before initializing a new instance.');\n      return;\n    }\n    this.config.enabled = true;\n    this.addPixelScript(pixelId);\n  }\n\n  /** Remove the Pixel tracking script */\n  remove(): void {\n    this.removePixelScript();\n    this.config.enabled = false;\n  }\n\n  /**\n   * Track a Standard Event as predefined by Facebook\n   *\n   * See {@link https://developers.facebook.com/docs/facebook-pixel/reference Facebook Pixel docs - reference}\n   * @param eventName The name of the event that is being tracked\n   * @param properties Optional properties of the event\n   */\n  track(\n    eventName: PixelEventName,\n    properties?: PixelEventProperties\n  ): void {\n    if (!isPlatformBrowser(this.platformId)) {\n      return;\n    }\n\n    if (!this.isLoaded()) {\n      console.warn('Tried to track an event without initializing a Pixel instance. Call `initialize()` first.');\n      return;\n    }\n\n    if (properties) {\n      fbq('track', eventName, properties);\n    } else {\n      fbq('track', eventName);\n    }\n\n  }\n\n  /**\n   * Track a custom Event\n   *\n   * See {@link https://developers.facebook.com/docs/facebook-pixel/implementation/conversion-tracking#custom-conversions Facebook Pixel docs - custom conversions}\n   * @param eventName The name of the event that is being tracked\n   * @param properties Optional properties of the event\n   */\n  trackCustom(eventName: string, properties?: object): void {\n    if (!isPlatformBrowser(this.platformId)) {\n      return;\n    }\n\n    if (!this.isLoaded()) {\n      console.warn('Tried to track an event without initializing a Pixel instance. Call `initialize()` first.');\n      return;\n    }\n\n    if (properties) {\n      fbq('trackCustom', eventName, properties);\n    } else {\n      fbq('trackCustom', eventName);\n    }\n  }\n\n  /**\n   * Adds the Facebook Pixel tracking script to the application\n   * @param pixelId The Facebook Pixel ID to use\n   */\n  private addPixelScript(pixelId: string): void {\n    if (!isPlatformBrowser(this.platformId)) {\n      return;\n    }\n\n    const pixelCode = `\n    var pixelCode = function(f,b,e,v,n,t,s)\n    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n    n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n    n.queue=[];t=b.createElement(e);t.async=!0;\n    t.src=v;s=b.getElementsByTagName(e)[0];\n    s.parentNode.insertBefore(t,s)}(window, document,'script',\n    'https://connect.facebook.net/en_US/fbevents.js');\n    fbq('init', '${pixelId}');\n    fbq('track', 'PageView');`;\n\n\n    const scriptElement = this.renderer.createElement('script');\n    this.renderer.setAttribute(scriptElement, 'id', 'pixel-script');\n    this.renderer.setAttribute(scriptElement, 'type', 'text/javascript');\n    this.renderer.setProperty(scriptElement, 'innerHTML', pixelCode);\n    this.renderer.appendChild(this.doc.head, scriptElement);\n  }\n\n  /** Remove Facebook Pixel tracking script from the application */\n  private removePixelScript(): void {\n    if (!isPlatformBrowser(this.platformId)) {\n      return;\n    }\n    const pixelElement = this.doc.getElementById('pixel-script');\n    if (pixelElement) {\n      pixelElement.remove();\n    }\n  }\n\n  /** Checks if the script element is present */\n  private isLoaded(): boolean {\n    if (isPlatformBrowser(this.platformId)) {\n      const pixelElement = this.doc.getElementById('pixel-script');\n      return !!pixelElement;\n    }\n    return false;\n  }\n\n}\n","import { PixelConfiguration } from './pixel.models';\nimport { Inject, ModuleWithProviders, NgModule, PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { PixelService } from './pixel.service';\n\n@NgModule({\n  imports: [],\n})\nexport class PixelModule {\n\n  private static config: PixelConfiguration | null = null;\n\n  constructor(\n    private pixel: PixelService,\n    @Inject(PLATFORM_ID) platformId: Object\n  ) {\n    if (!PixelModule.config) {\n      throw Error('ngx-pixel not configured correctly. Pass the `pixelId` property to the `forRoot()` function');\n    }\n    if (PixelModule.config.enabled && isPlatformBrowser(platformId)) {\n      this.pixel.initialize();\n    }\n  }\n\n  /**\n   * Initiale the Facebook Pixel Module\n   *\n   * Add your Pixel ID as parameter\n   */\n  static forRoot(config: PixelConfiguration): ModuleWithProviders<PixelModule> {\n    this.config = config;\n    const pixelId = config.pixelId;\n    this.verifyPixelId(pixelId);\n\n    return {\n      ngModule: PixelModule,\n      providers: [PixelService, { provide: 'config', useValue: config }]\n    };\n  }\n\n  /**\n   * Verifies the Pixel ID that was passed into the configuration.\n   * - Checks if Pixel was initialized\n   * @param pixelId Pixel ID to verify\n   */\n  private static verifyPixelId(pixelId: string): void {\n    // Have to verify first that all Pixel IDs follow the same 15 digit format\n    if (pixelId === null || pixelId === undefined || pixelId.length === 0) {\n      throw Error('Invalid Facebook Pixel ID. Did you pass the ID into the forRoot() function?');\n    }\n  }\n\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {PixelConfiguration as Éµa} from './lib/pixel.models';"],"names":["filter","NavigationEnd","isPlatformBrowser","Injectable","Inject","DOCUMENT","PLATFORM_ID","Router","Optional","RendererFactory2","NgModule"],"mappings":"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"}