import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef, ElementRef } from '@angular/core';
import { NgxSpinnerService } from './ngx-spinner.service';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { DEFAULTS, NgxSpinner, PRIMARY_SPINNER } from './ngx-spinner.enum';
// import { trigger, state, style, transition, animate } from '@angular/animations';
export class NgxSpinnerComponent {
    /**
     * Creates an instance of NgxSpinnerComponent.
     *
     * @memberof NgxSpinnerComponent
     */
    constructor(spinnerService, changeDetector, elementRef) {
        this.spinnerService = spinnerService;
        this.changeDetector = changeDetector;
        this.elementRef = elementRef;
        /**
         * button Spinner.
         * https://getbootstrap.com/docs/4.4/components/spinners/#buttons
         *
         * @memberof NgxSpinnerComponent
         *
         */
        this.isButtonSpinner = false;
        /**
         * isButtonSpinner is true and when the spinner shown,the button disabled set to true
         *
         * @memberof NgxSpinnerComponent
         *
         */
        this.autoDisableButton = false;
        /**
         * Spinner Object
         *
         * @memberof NgxSpinnerComponent
         */
        this.spinner = new NgxSpinner();
        /**
         * Unsubscribe from spinner's observable
         *
         * @memberof NgxSpinnerComponent
        **/
        this.ngUnsubscribe = new Subject();
        /**
         * To set default ngx-spinner options
         *
         * @memberof NgxSpinnerComponent
         */
        this.setDefaultOptions = () => {
            this.spinner = new NgxSpinner({
                name: this.name,
                bdColor: this.bdColor,
                size: this.size,
                color: this.color,
                type: this.type,
                fullScreen: this.fullScreen,
                show: this.show,
                zIndex: this.zIndex,
                loaderTemplate: this.loaderTemplate,
                loadingTextTemplate: this.loadingTextTemplate,
                autoDisableButton: this.autoDisableButton
            });
        };
        this.bdColor = DEFAULTS.BD_COLOR;
        this.zIndex = DEFAULTS.Z_INDEX;
        this.color = DEFAULTS.SPINNER_COLOR;
        this.type = DEFAULTS.SPINNER_TYPE;
        this.size = 'default';
        this.fullScreen = true;
        this.name = PRIMARY_SPINNER;
        this.loaderTemplate = null;
        this.show = false;
    }
    /**
     * Initialization method
     *
     * @memberof NgxSpinnerComponent
     */
    ngOnInit() {
        this.setDefaultOptions();
        this.spinnerService.getSpinner(this.name).subscribe(x => {
            if (this.isButtonSpinner && this.autoDisableButton) {
                let button = this.elementRef.nativeElement.closest("button");
                button.disabled = x.show;
            }
        });
        this.spinnerService.getSpinner(this.name)
            .pipe(takeUntil(this.ngUnsubscribe))
            .subscribe((spinner) => {
            this.setDefaultOptions();
            Object.assign(this.spinner, spinner);
            if (spinner.show) {
                this.onInputChange();
            }
            this.changeDetector.markForCheck();
        });
    }
    /**
     * On changes event for input variables
     *
     * @memberof NgxSpinnerComponent
     */
    ngOnChanges(changes) {
        for (const propName in changes) {
            if (propName) {
                const changedProp = changes[propName];
                if (changedProp.isFirstChange()) {
                    return;
                }
                else if (typeof changedProp.currentValue !== 'undefined' && changedProp.currentValue !== changedProp.previousValue) {
                    if (changedProp.currentValue !== '') {
                        this.spinner[propName] = changedProp.currentValue;
                    }
                }
            }
        }
    }
    /**
     * To get class for spinner
     *
     * @memberof NgxSpinnerComponent
     */
    getClass(type, size) {
        let sizeClass = '';
        switch (size.toLowerCase()) {
            case 'small':
                sizeClass = 'sm';
                break;
            default:
                break;
        }
        if (sizeClass == '')
            return ['spinner-' + type];
        else
            return ['spinner-' + type, 'spinner-' + type + '-' + sizeClass];
    }
    /**
     * Check if input variables have changed
     *
     * @memberof NgxSpinnerComponent
     */
    onInputChange() {
        this.spinner.class = this.getClass(this.spinner.type, this.spinner.size);
    }
    /**
     * Component destroy event
     *
     * @memberof NgxSpinnerComponent
     */
    ngOnDestroy() {
        this.ngUnsubscribe.next();
        this.ngUnsubscribe.complete();
    }
}
NgxSpinnerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-bootstrap-spinner',
                template: "<div *ngIf=\"!isButtonSpinner&&spinner.show\"\r\n  class=\"overlay d-flex flex-column justify-content-center align-items-center\"\r\n  [style.background-color]=\"spinner.bdColor\" [style.z-index]=\"spinner.zIndex\"\r\n  [style.position]=\"spinner.fullScreen ? 'fixed' : 'absolute'\" [style.color]=\"spinner.color\">\r\n  <ng-container *ngTemplateOutlet=\"loadingTemplate\"></ng-container>\r\n</div>\r\n\r\n<ng-container *ngIf=\"isButtonSpinner&&spinner.show\" [ngTemplateOutlet]=\"loadingTemplate\">\r\n</ng-container>\r\n\r\n<ng-template #loadingTemplate>\r\n  <span *ngIf=\"!loaderTemplate\" [ngClass]=\"spinner.class\" role=\"status\" aria-hidden=\"true\">\r\n    <span class=\"sr-only\">{{loadingText}}</span>\r\n  </span>\r\n  <div *ngIf=\"loaderTemplate\" [innerHTML]=\"loaderTemplate | safeHtml\"></div>\r\n  <div *ngIf=\"!loadingTextTemplate\" [ngClass]=\"{'sr-only': isButtonSpinner,'loading-text':!isButtonSpinner}\">\r\n    {{loadingText}}\r\n  </div>\r\n  {{isButtonSpinner&&!loadingTextTemplate?loadingText:\"\"}}\r\n  <div *ngIf=\"loadingTextTemplate\" [innerHTML]=\"loadingTextTemplate | safeHtml\"></div>\r\n</ng-template>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".overlay{height:100%;left:0;position:fixed;top:0;width:100%}"]
            },] }
];
NgxSpinnerComponent.ctorParameters = () => [
    { type: NgxSpinnerService },
    { type: ChangeDetectorRef },
    { type: ElementRef }
];
NgxSpinnerComponent.propDecorators = {
    bdColor: [{ type: Input }],
    size: [{ type: Input }],
    color: [{ type: Input }],
    type: [{ type: Input }],
    fullScreen: [{ type: Input }],
    name: [{ type: Input }],
    zIndex: [{ type: Input }],
    loaderTemplate: [{ type: Input }],
    loadingText: [{ type: Input }],
    loadingTextTemplate: [{ type: Input }],
    isButtonSpinner: [{ type: Input }],
    autoDisableButton: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNwaW5uZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWJvb3RzdHJhcC1zcGlubmVyL3NyYy9saWIvbmd4LXNwaW5uZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBRVQsS0FBSyxFQUlMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsVUFBVSxFQUNYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxRQUFRLEVBQVEsVUFBVSxFQUFFLGVBQWUsRUFBVyxNQUFNLG9CQUFvQixDQUFDO0FBQzFGLG9GQUFvRjtBQW1CcEYsTUFBTSxPQUFPLG1CQUFtQjtJQWtHOUI7Ozs7T0FJRztJQUNILFlBQW9CLGNBQWlDLEVBQVUsY0FBaUMsRUFBVSxVQUFzQjtRQUE1RyxtQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFBVSxtQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBekNoSTs7Ozs7O1dBTUc7UUFDTSxvQkFBZSxHQUFZLEtBQUssQ0FBQztRQUUxQzs7Ozs7V0FLRztRQUNNLHNCQUFpQixHQUFZLEtBQUssQ0FBQztRQUU1Qzs7OztXQUlHO1FBQ0gsWUFBTyxHQUFlLElBQUksVUFBVSxFQUFFLENBQUM7UUFPdkM7Ozs7V0FJRztRQUNILGtCQUFhLEdBQWtCLElBQUksT0FBTyxFQUFFLENBQUM7UUE2QzdDOzs7O1dBSUc7UUFDSCxzQkFBaUIsR0FBRyxHQUFHLEVBQUU7WUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFVBQVUsQ0FBQztnQkFDNUIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2dCQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztnQkFDckIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2dCQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztnQkFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2dCQUNmLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtnQkFDM0IsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2dCQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTTtnQkFDbkIsY0FBYyxFQUFFLElBQUksQ0FBQyxjQUFjO2dCQUNuQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsbUJBQW1CO2dCQUM3QyxpQkFBaUIsRUFBQyxJQUFJLENBQUMsaUJBQWlCO2FBQ3pDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQTtRQXhEQyxJQUFJLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUM7UUFDakMsSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDO1FBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQztRQUNwQyxJQUFJLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxZQUFZLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksR0FBRyxTQUFTLENBQUM7UUFDdEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksR0FBRyxlQUFlLENBQUM7UUFDNUIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7UUFFM0IsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7SUFDcEIsQ0FBQztJQUNEOzs7O09BSUc7SUFDSCxRQUFRO1FBQ04sSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUN0RCxJQUFJLElBQUksQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO2dCQUNsRCxJQUFJLE1BQU0sR0FBSSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQTZCLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUM5RSxNQUFNLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7YUFDMUI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7YUFDdEMsSUFBSSxDQUNILFNBQVMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQzlCO2FBQ0EsU0FBUyxDQUFDLENBQUMsT0FBbUIsRUFBRSxFQUFFO1lBQ2pDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztZQUNyQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQzthQUN0QjtZQUNELElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBcUJEOzs7O09BSUc7SUFDSCxXQUFXLENBQUMsT0FBNEM7UUFDdEQsS0FBSyxNQUFNLFFBQVEsSUFBSSxPQUFPLEVBQUU7WUFDOUIsSUFBSSxRQUFRLEVBQUU7Z0JBQ1osTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN0QyxJQUFJLFdBQVcsQ0FBQyxhQUFhLEVBQUUsRUFBRTtvQkFDL0IsT0FBTztpQkFDUjtxQkFBTSxJQUFJLE9BQU8sV0FBVyxDQUFDLFlBQVksS0FBSyxXQUFXLElBQUksV0FBVyxDQUFDLFlBQVksS0FBSyxXQUFXLENBQUMsYUFBYSxFQUFFO29CQUNwSCxJQUFJLFdBQVcsQ0FBQyxZQUFZLEtBQUssRUFBRSxFQUFFO3dCQUNuQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxZQUFZLENBQUM7cUJBQ25EO2lCQUNGO2FBQ0Y7U0FDRjtJQUNILENBQUM7SUFDRDs7OztPQUlHO0lBQ0gsUUFBUSxDQUFDLElBQVksRUFBRSxJQUFVO1FBQy9CLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNuQixRQUFRLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRTtZQUMxQixLQUFLLE9BQU87Z0JBQ1YsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDakIsTUFBTTtZQUNSO2dCQUNFLE1BQU07U0FDVDtRQUNELElBQUksU0FBUyxJQUFJLEVBQUU7WUFDakIsT0FBTyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsQ0FBQzs7WUFFM0IsT0FBTyxDQUFDLFVBQVUsR0FBRyxJQUFJLEVBQUUsVUFBVSxHQUFHLElBQUksR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUNEOzs7O09BSUc7SUFDSCxhQUFhO1FBQ1gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFDRDs7OztPQUlHO0lBQ0gsV0FBVztRQUNULElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNoQyxDQUFDOzs7WUF4T0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSx1QkFBdUI7Z0JBQ2pDLGtvQ0FBeUM7Z0JBRXpDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOzthQVloRDs7O1lBdEJRLGlCQUFpQjtZQUh4QixpQkFBaUI7WUFDakIsVUFBVTs7O3NCQWdDVCxLQUFLO21CQU1MLEtBQUs7b0JBTUwsS0FBSzttQkFNTCxLQUFLO3lCQU1MLEtBQUs7bUJBTUwsS0FBSztxQkFNTCxLQUFLOzZCQU1MLEtBQUs7MEJBTUwsS0FBSztrQ0FNTCxLQUFLOzhCQVFMLEtBQUs7Z0NBUUwsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25EZXN0cm95LFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZSxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBFbGVtZW50UmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmd4U3Bpbm5lclNlcnZpY2UgfSBmcm9tICcuL25neC1zcGlubmVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgREVGQVVMVFMsIFNpemUsIE5neFNwaW5uZXIsIFBSSU1BUllfU1BJTk5FUiwgTE9BREVSUyB9IGZyb20gJy4vbmd4LXNwaW5uZXIuZW51bSc7XG4vLyBpbXBvcnQgeyB0cmlnZ2VyLCBzdGF0ZSwgc3R5bGUsIHRyYW5zaXRpb24sIGFuaW1hdGUgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWJvb3RzdHJhcC1zcGlubmVyJyxcbiAgdGVtcGxhdGVVcmw6ICduZ3gtc3Bpbm5lci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWyduZ3gtc3Bpbm5lci5jb21wb25lbnQuY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAvLyBhbmltYXRpb25zOiBbXG4gIC8vICAgdHJpZ2dlcignZmFkZUluJywgW1xuICAvLyAgICAgc3RhdGUoJ2luJywgc3R5bGUoeyBvcGFjaXR5OiAxIH0pKSxcbiAgLy8gICAgIHRyYW5zaXRpb24oJzplbnRlcicsIFtcbiAgLy8gICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwIH0pLFxuICAvLyAgICAgICBhbmltYXRlKDMwMClcbiAgLy8gICAgIF0pLFxuICAvLyAgICAgdHJhbnNpdGlvbignOmxlYXZlJyxcbiAgLy8gICAgICAgYW5pbWF0ZSgyMDAsIHN0eWxlKHsgb3BhY2l0eTogMCB9KSkpXG4gIC8vICAgXSlcbiAgLy8gXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hTcGlubmVyQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgLyoqXG4gICAqIFRvIHNldCBiYWNrZHJvcCBjb2xvclxuICAgKiBPbmx5IHN1cHBvcnRzIFJHQkEgY29sb3IgZm9ybWF0XG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSBiZENvbG9yOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUbyBzZXQgc3Bpbm5lciBzaXplXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSBzaXplOiBTaXplO1xuICAvKipcbiAgICogVG8gc2V0IHNwaW5uZXIgY29sb3IoREVGQVVMVFMuU1BJTk5FUl9DT0xPUilcbiAgICpcbiAgICogQG1lbWJlcm9mIE5neFNwaW5uZXJDb21wb25lbnRcbiAgICovXG4gIEBJbnB1dCgpIGNvbG9yOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUbyBzZXQgdHlwZSBvZiBzcGlubmVyXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSB0eXBlOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUbyB0b2dnbGUgZnVsbHNjcmVlbiBtb2RlXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSBmdWxsU2NyZWVuOiBib29sZWFuO1xuICAvKipcbiAgICogU3Bpbm5lciBuYW1lXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiB6LWluZGV4IHZhbHVlXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSB6SW5kZXg6IG51bWJlcjtcbiAgLyoqXG4gICAqIEN1c3RvbSBsb2FkZXIgZm9yIHNwaW5uZXIvbG9hZGVyXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBASW5wdXQoKSBsb2FkZXJUZW1wbGF0ZTogc3RyaW5nO1xuICAvKipcbiAqIGRpc3BsYXkgbG9hZGluZyB0ZXh0XG4gKlxuICogQG1lbWJlcm9mIE5neFNwaW5uZXJDb21wb25lbnRcbiAqL1xuICBASW5wdXQoKSBsb2FkaW5nVGV4dDogc3RyaW5nO1xuICAvKipcbiAqIEN1c3RvbSBsb2FkaW5nIHRleHQgVGVtcGxhdGUgZm9yIHNwaW5uZXIvbG9hZGVyXG4gKlxuICogQG1lbWJlcm9mIE5neFNwaW5uZXJDb21wb25lbnRcbiAqL1xuICBASW5wdXQoKSBsb2FkaW5nVGV4dFRlbXBsYXRlOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBidXR0b24gU3Bpbm5lci5cbiAgICogaHR0cHM6Ly9nZXRib290c3RyYXAuY29tL2RvY3MvNC40L2NvbXBvbmVudHMvc3Bpbm5lcnMvI2J1dHRvbnNcbiAgICpcbiAgICogQG1lbWJlcm9mIE5neFNwaW5uZXJDb21wb25lbnRcbiAgICpcbiAgICovXG4gIEBJbnB1dCgpIGlzQnV0dG9uU3Bpbm5lcjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBpc0J1dHRvblNwaW5uZXIgaXMgdHJ1ZSBhbmQgd2hlbiB0aGUgc3Bpbm5lciBzaG93bix0aGUgYnV0dG9uIGRpc2FibGVkIHNldCB0byB0cnVlXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqXG4gICAqL1xuICBASW5wdXQoKSBhdXRvRGlzYWJsZUJ1dHRvbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTcGlubmVyIE9iamVjdFxuICAgKlxuICAgKiBAbWVtYmVyb2YgTmd4U3Bpbm5lckNvbXBvbmVudFxuICAgKi9cbiAgc3Bpbm5lcjogTmd4U3Bpbm5lciA9IG5ldyBOZ3hTcGlubmVyKCk7XG4gIC8qKlxuICAgKiBTaG93IHNwaW5uZXJcbiAgICpcbiAgICogQG1lbWJlcm9mIE5neFNwaW5uZXJDb21wb25lbnRcbiAgKiovXG4gIHNob3c6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBVbnN1YnNjcmliZSBmcm9tIHNwaW5uZXIncyBvYnNlcnZhYmxlXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICoqL1xuICBuZ1Vuc3Vic2NyaWJlOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBOZ3hTcGlubmVyQ29tcG9uZW50LlxuICAgKlxuICAgKiBAbWVtYmVyb2YgTmd4U3Bpbm5lckNvbXBvbmVudFxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzcGlubmVyU2VydmljZTogTmd4U3Bpbm5lclNlcnZpY2UsIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHtcbiAgICB0aGlzLmJkQ29sb3IgPSBERUZBVUxUUy5CRF9DT0xPUjtcbiAgICB0aGlzLnpJbmRleCA9IERFRkFVTFRTLlpfSU5ERVg7XG4gICAgdGhpcy5jb2xvciA9IERFRkFVTFRTLlNQSU5ORVJfQ09MT1I7XG4gICAgdGhpcy50eXBlID0gREVGQVVMVFMuU1BJTk5FUl9UWVBFO1xuICAgIHRoaXMuc2l6ZSA9ICdkZWZhdWx0JztcbiAgICB0aGlzLmZ1bGxTY3JlZW4gPSB0cnVlO1xuICAgIHRoaXMubmFtZSA9IFBSSU1BUllfU1BJTk5FUjtcbiAgICB0aGlzLmxvYWRlclRlbXBsYXRlID0gbnVsbDtcblxuICAgIHRoaXMuc2hvdyA9IGZhbHNlO1xuICB9XG4gIC8qKlxuICAgKiBJbml0aWFsaXphdGlvbiBtZXRob2RcbiAgICpcbiAgICogQG1lbWJlcm9mIE5neFNwaW5uZXJDb21wb25lbnRcbiAgICovXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc2V0RGVmYXVsdE9wdGlvbnMoKTtcbiAgICB0aGlzLnNwaW5uZXJTZXJ2aWNlLmdldFNwaW5uZXIodGhpcy5uYW1lKS5zdWJzY3JpYmUoeCA9PiB7XG4gICAgICBpZiAodGhpcy5pc0J1dHRvblNwaW5uZXIgJiYgdGhpcy5hdXRvRGlzYWJsZUJ1dHRvbikge1xuICAgICAgICBsZXQgYnV0dG9uID0gKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5jbG9zZXN0KFwiYnV0dG9uXCIpO1xuICAgICAgICBidXR0b24uZGlzYWJsZWQgPSB4LnNob3c7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5zcGlubmVyU2VydmljZS5nZXRTcGlubmVyKHRoaXMubmFtZSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlVW50aWwodGhpcy5uZ1Vuc3Vic2NyaWJlKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoc3Bpbm5lcjogTmd4U3Bpbm5lcikgPT4ge1xuICAgICAgICB0aGlzLnNldERlZmF1bHRPcHRpb25zKCk7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5zcGlubmVyLCBzcGlubmVyKTtcbiAgICAgICAgaWYgKHNwaW5uZXIuc2hvdykge1xuICAgICAgICAgIHRoaXMub25JbnB1dENoYW5nZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IubWFya0ZvckNoZWNrKCk7XG4gICAgICB9KTtcbiAgfVxuICAvKipcbiAgICogVG8gc2V0IGRlZmF1bHQgbmd4LXNwaW5uZXIgb3B0aW9uc1xuICAgKlxuICAgKiBAbWVtYmVyb2YgTmd4U3Bpbm5lckNvbXBvbmVudFxuICAgKi9cbiAgc2V0RGVmYXVsdE9wdGlvbnMgPSAoKSA9PiB7XG4gICAgdGhpcy5zcGlubmVyID0gbmV3IE5neFNwaW5uZXIoe1xuICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgYmRDb2xvcjogdGhpcy5iZENvbG9yLFxuICAgICAgc2l6ZTogdGhpcy5zaXplLFxuICAgICAgY29sb3I6IHRoaXMuY29sb3IsXG4gICAgICB0eXBlOiB0aGlzLnR5cGUsXG4gICAgICBmdWxsU2NyZWVuOiB0aGlzLmZ1bGxTY3JlZW4sXG4gICAgICBzaG93OiB0aGlzLnNob3csXG4gICAgICB6SW5kZXg6IHRoaXMuekluZGV4LFxuICAgICAgbG9hZGVyVGVtcGxhdGU6IHRoaXMubG9hZGVyVGVtcGxhdGUsXG4gICAgICBsb2FkaW5nVGV4dFRlbXBsYXRlOiB0aGlzLmxvYWRpbmdUZXh0VGVtcGxhdGUsXG4gICAgICBhdXRvRGlzYWJsZUJ1dHRvbjp0aGlzLmF1dG9EaXNhYmxlQnV0dG9uXG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIE9uIGNoYW5nZXMgZXZlbnQgZm9yIGlucHV0IHZhcmlhYmxlc1xuICAgKlxuICAgKiBAbWVtYmVyb2YgTmd4U3Bpbm5lckNvbXBvbmVudFxuICAgKi9cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogeyBbcHJvcEtleTogc3RyaW5nXTogU2ltcGxlQ2hhbmdlIH0pIHtcbiAgICBmb3IgKGNvbnN0IHByb3BOYW1lIGluIGNoYW5nZXMpIHtcbiAgICAgIGlmIChwcm9wTmFtZSkge1xuICAgICAgICBjb25zdCBjaGFuZ2VkUHJvcCA9IGNoYW5nZXNbcHJvcE5hbWVdO1xuICAgICAgICBpZiAoY2hhbmdlZFByb3AuaXNGaXJzdENoYW5nZSgpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjaGFuZ2VkUHJvcC5jdXJyZW50VmFsdWUgIT09ICd1bmRlZmluZWQnICYmIGNoYW5nZWRQcm9wLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlZFByb3AucHJldmlvdXNWYWx1ZSkge1xuICAgICAgICAgIGlmIChjaGFuZ2VkUHJvcC5jdXJyZW50VmFsdWUgIT09ICcnKSB7XG4gICAgICAgICAgICB0aGlzLnNwaW5uZXJbcHJvcE5hbWVdID0gY2hhbmdlZFByb3AuY3VycmVudFZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAvKipcbiAgICogVG8gZ2V0IGNsYXNzIGZvciBzcGlubmVyXG4gICAqXG4gICAqIEBtZW1iZXJvZiBOZ3hTcGlubmVyQ29tcG9uZW50XG4gICAqL1xuICBnZXRDbGFzcyh0eXBlOiBzdHJpbmcsIHNpemU6IFNpemUpOiBzdHJpbmdbXSB7XG4gICAgbGV0IHNpemVDbGFzcyA9ICcnO1xuICAgIHN3aXRjaCAoc2l6ZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBjYXNlICdzbWFsbCc6XG4gICAgICAgIHNpemVDbGFzcyA9ICdzbSc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmIChzaXplQ2xhc3MgPT0gJycpXG4gICAgICByZXR1cm4gWydzcGlubmVyLScgKyB0eXBlXTtcbiAgICBlbHNlXG4gICAgICByZXR1cm4gWydzcGlubmVyLScgKyB0eXBlLCAnc3Bpbm5lci0nICsgdHlwZSArICctJyArIHNpemVDbGFzc107XG4gIH1cbiAgLyoqXG4gICAqIENoZWNrIGlmIGlucHV0IHZhcmlhYmxlcyBoYXZlIGNoYW5nZWRcbiAgICpcbiAgICogQG1lbWJlcm9mIE5neFNwaW5uZXJDb21wb25lbnRcbiAgICovXG4gIG9uSW5wdXRDaGFuZ2UoKSB7XG4gICAgdGhpcy5zcGlubmVyLmNsYXNzID0gdGhpcy5nZXRDbGFzcyh0aGlzLnNwaW5uZXIudHlwZSwgdGhpcy5zcGlubmVyLnNpemUpO1xuICB9XG4gIC8qKlxuICAgKiBDb21wb25lbnQgZGVzdHJveSBldmVudFxuICAgKlxuICAgKiBAbWVtYmVyb2YgTmd4U3Bpbm5lckNvbXBvbmVudFxuICAgKi9cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5uZ1Vuc3Vic2NyaWJlLm5leHQoKTtcbiAgICB0aGlzLm5nVW5zdWJzY3JpYmUuY29tcGxldGUoKTtcbiAgfVxufVxuIl19