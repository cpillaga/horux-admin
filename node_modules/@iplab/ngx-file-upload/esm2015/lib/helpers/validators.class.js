import { IsNullOrEmpty } from './helpers.class';
import { FileUploadTypes } from './file-types.class';
/**
 * function used to check file size
 */
const checkFileSize = (file, maxSize, minSize = 0) => {
    return (!IsNullOrEmpty(maxSize) && file.size > maxSize) || file.size < minSize ?
        { maxSize, minSize, actual: file.size, file } : null;
};
const ɵ0 = checkFileSize;
const getFileType = (file, fileExtension) => {
    const type = file.type;
    if (!IsNullOrEmpty(type)) {
        return type;
    }
    return FileUploadTypes[fileExtension];
};
const ɵ1 = getFileType;
const FILE_EXT_REG = /(^[.]\w*)$/m;
/**
 * function used to check file type
 *
 * #### allowedTypes
 * file_extension|audio/*|video/*|image/*|media_type
 */
const checkFileType = (file, allowedTypes) => {
    const fileExtension = file.name.split('.').pop().toLowerCase();
    const fileType = getFileType(file, fileExtension);
    for (const type of allowedTypes) {
        const isValid = FILE_EXT_REG.test(type) ? type === `.${fileExtension}` : new RegExp(type).test(fileType);
        if (isValid) {
            return null;
        }
    }
    return { allowedTypes, actual: file.type, file };
};
const ɵ2 = checkFileType;
const checkValueType = (value) => {
    if (!Array.isArray(value)) {
        throw Error(`FormControl.setValue was provided with wrong argument type, ${value} was provided instead Array<File>`);
    }
};
const ɵ3 = checkValueType;
// @dynamic
export class FileUploadValidators {
    /**
     * Validator that requires controls to have a file maximum size length.
     * Compare the File size in bytes
     * @dynamic
     */
    static fileSize(maxSize) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            const toLargeFiles = files.map((file) => checkFileSize(file, maxSize))
                .filter((error) => error);
            return toLargeFiles.length > 0 ?
                { 'fileSize': toLargeFiles } : null;
        };
    }
    /**
     * Compare the File size in bytes with max and min size limits
     * @dynamic
     */
    static sizeRange({ minSize, maxSize }) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            const sizeMismatch = files.map((file) => checkFileSize(file, maxSize, minSize))
                .filter((error) => error);
            return sizeMismatch.length > 0 ?
                { 'sizeRange': sizeMismatch } : null;
        };
    }
    /**
     * validator that requires control to have limit on files number
     * @dynamic
     */
    static filesLimit(numFiles) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            return files.length > numFiles ?
                { 'filesLimit': { 'max': numFiles, 'actual': files.length } } : null;
        };
    }
    /**
     * validator that requires control to have limit on media types
     *
     * ##### Allowed media types are
     *
     * - file_extension - a file extension starting with the STOP character,
     * e.g: .gif, .jpg, .png, .doc
     * - audio/* -        All sound files are accepted
     * - video/* -        All video files are accepted
     * - image/* -        All image files are accepted
     * - media_type -     A valid media type, with no parameters. Look at [IANA Media Types](https://www.iana.org/assignments/media-types/media-types.xhtml) for a complete list of standard media types
     *
     * #### Example
     * `FileUploadValidators.accept([file_extension, audio/*, video/*, image/*, media_type])`
     * @dynamic
     */
    static accept(allowedFileTypes) {
        return (control) => {
            const files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            const notAllowedFiles = files.map((file) => checkFileType(file, allowedFileTypes))
                .filter((error) => error);
            return notAllowedFiles.length > 0 ?
                { 'fileTypes': notAllowedFiles } : null;
        };
    }
}
export { ɵ0, ɵ1, ɵ2, ɵ3 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdG9ycy5jbGFzcy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BpcGxhYi9uZ3gtZmlsZS11cGxvYWQvIiwic291cmNlcyI6WyJsaWIvaGVscGVycy92YWxpZGF0b3JzLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVoRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFVckQ7O0dBRUc7QUFDSCxNQUFNLGFBQWEsR0FBRyxDQUFDLElBQVUsRUFBRSxPQUFlLEVBQUUsVUFBa0IsQ0FBQyxFQUEyQixFQUFFO0lBQ2hHLE9BQU8sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUM7UUFDNUUsRUFBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDM0QsQ0FBQyxDQUFDOztBQUVGLE1BQU0sV0FBVyxHQUFHLENBQUMsSUFBVSxFQUFFLGFBQXFCLEVBQW1CLEVBQUU7SUFDdkUsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN2QixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ3RCLE9BQU8sSUFBdUIsQ0FBQztLQUNsQztJQUVELE9BQU8sZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzFDLENBQUMsQ0FBQzs7QUFFRixNQUFNLFlBQVksR0FBRyxhQUFhLENBQUM7QUFDbkM7Ozs7O0dBS0c7QUFDSCxNQUFNLGFBQWEsR0FBRyxDQUFDLElBQVUsRUFBRSxZQUEyQixFQUEyQixFQUFFO0lBQ3ZGLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMs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YSxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUFFLE9BQU8sSUFBSSxDQUFDO2FBQUU7WUFDMUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRXRCLE9BQU8sS0FBSyxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsQ0FBQztnQkFDNUIsRUFBQyxZQUFZLEVBQUUsRUFBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsTUFBTSxFQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ3pFLENBQUMsQ0FBQztJQUNOLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7O09BZUc7SUFDSSxNQUFNLENBQUMsTUFBTSxDQUFDLGdCQUErQjtRQUNoRCxPQUFPLENBQUMsT0FBNEMsRUFBb0IsRUFBRTtZQUN0RSxNQUFNLEtBQUssR0FBZ0IsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUN6QyxJQUFJLGFBQWEsQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFBRSxPQUFPLElBQUksQ0FBQzthQUFFO1lBQzFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUV0QixNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLGdCQUFnQixDQUFDLENBQUM7aUJBQ3JELE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFdEQsT0FBTyxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUMvQixFQUFDLFdBQVcsRUFBRSxlQUFlLEVBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzlDLENBQUMsQ0FBQztJQUNOLENBQUM7Q0FFSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFic3RyYWN0Q29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgSXNOdWxsT3JFbXB0eSB9IGZyb20gJy4vaGVscGVycy5jbGFzcyc7XHJcbmltcG9ydCB7IEZpbGVVcGxvYWRDb250cm9sIH0gZnJvbSAnLi9jb250cm9sLmNsYXNzJztcclxuaW1wb3J0IHsgRmlsZVVwbG9hZFR5cGVzIH0gZnJvbSAnLi9maWxlLXR5cGVzLmNsYXNzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvbkVycm9ycyB7XHJcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdG9yRm4ge1xyXG4gICAgKGM6IEFic3RyYWN0Q29udHJvbCB8IEZpbGVVcGxvYWRDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGw7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBmdW5jdGlvbiB1c2VkIHRvIGNoZWNrIGZpbGUgc2l6ZVxyXG4gKi9cclxuY29uc3QgY2hlY2tGaWxlU2l6ZSA9IChmaWxlOiBGaWxlLCBtYXhTaXplOiBudW1iZXIsIG1pblNpemU6IG51bWJlciA9IDApOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCA9PiB7XHJcbiAgICByZXR1cm4gKCFJc051bGxPckVtcHR5KG1heFNpemUpICYmIGZpbGUuc2l6ZSA+IG1heFNpemUpIHx8IGZpbGUuc2l6ZSA8IG1pblNpemUgP1xyXG4gICAgICAgIHttYXhTaXplLCBtaW5TaXplLCBhY3R1YWw6IGZpbGUuc2l6ZSwgZmlsZX0gOiBudWxsO1xyXG59O1xyXG5cclxuY29uc3QgZ2V0RmlsZVR5cGUgPSAoZmlsZTogRmlsZSwgZmlsZUV4dGVuc2lvbjogc3RyaW5nKTogRmlsZVVwbG9hZFR5cGVzID0+IHtcclxuICAgIGNvbnN0IHR5cGUgPSBmaWxlLnR5cGU7XHJcbiAgICBpZiAoIUlzTnVsbE9yRW1wdHkodHlwZSkpIHtcclxuICAgICAgICByZXR1cm4gdHlwZSBhcyBGaWxlVXBsb2FkVHlwZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIEZpbGVVcGxvYWRUeXBlc1tmaWxlRXh0ZW5zaW9uXTtcclxufTtcclxuXHJcbmNvbnN0IEZJTEVfRVhUX1JFRyA9IC8oXlsuXVxcdyopJC9tO1xyXG4vKipcclxuICogZnVuY3Rpb24gdXNlZCB0byBjaGVjayBmaWxlIHR5cGVcclxuICpcclxuICogIyMjIyBhbGxvd2VkVHlwZXNcclxuICogZmlsZV9leHRlbnNpb258YXVkaW8vKnx2aWRlby8qfGltYWdlLyp8bWVkaWFfdHlwZVxyXG4gKi9cclxuY29uc3QgY2hlY2tGaWxlVHlwZSA9IChmaWxlOiBGaWxlLCBhbGxvd2VkVHlwZXM6IEFycmF5PHN0cmluZz4pOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCA9PiB7XHJcbiAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCkudG9Mb3dlckNhc2UoKTtcclxuICAgIGNvbnN0IGZpbGVUeXBlID0gZ2V0RmlsZVR5cGUoZmlsZSwgZmlsZUV4dGVuc2lvbik7XHJcblxyXG4gICAgZm9yIChjb25zdCB0eXBlIG9mIGFsbG93ZWRUeXBlcyApIHtcclxuICAgICAgICBjb25zdCBpc1ZhbGlkID0gRklMRV9FWFRfUkVHLnRlc3QodHlwZSkgPyB0eXBlID09PSBgLiR7ZmlsZUV4dGVuc2lvbn1gIDogbmV3IFJlZ0V4cCh0eXBlKS50ZXN0KGZpbGVUeXBlKTtcclxuICAgICAgICBpZiAoaXNWYWxpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHthbGxvd2VkVHlwZXMsIGFjdHVhbDogZmlsZS50eXBlLCBmaWxlfTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrVmFsdWVUeXBlID0gKHZhbHVlOiBhbnkgKTogdm9pZCA9PiB7XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgdGhyb3cgRXJyb3IoYEZvcm1Db250cm9sLnNldFZhbHVlIHdhcyBwcm92aWRlZCB3aXRoIHdyb25nIGFyZ3VtZW50IHR5cGUsICR7dmFsdWV9IHdhcyBwcm92aWRlZCBpbnN0ZWFkIEFycmF5PEZpbGU+YCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZHluYW1pY1xyXG5leHBvcnQgY2xhc3MgRmlsZVVwbG9hZFZhbGlkYXRvcnMge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVmFsaWRhdG9yIHRoYXQgcmVxdWlyZXMgY29udHJvbHMgdG8gaGF2ZSBhIGZpbGUgbWF4aW11bSBzaXplIGxlbmd0aC5cclxuICAgICAqIENvbXBhcmUgdGhlIEZpbGUgc2l6ZSBpbiBieXRlc1xyXG4gICAgICogQGR5bmFtaWNcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBmaWxlU2l6ZShtYXhTaXplOiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wgfCBGaWxlVXBsb2FkQ29udHJvbCk6IHtmaWxlU2l6ZTogQXJyYXk8VmFsaWRhdGlvbkVycm9ycz59ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZXM6IEFycmF5PEZpbGU+ID0gY29udHJvbC52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKElzTnVsbE9yRW1wdHkoZmlsZXMpKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgICAgIGNoZWNrVmFsdWVUeXBlKGZpbGVzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRvTGFyZ2VGaWxlcyA9IGZpbGVzLm1hcCgoZmlsZSkgPT4gY2hlY2tGaWxlU2l6ZShmaWxlLCBtYXhTaXplKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGVycm9yKSA9PiBlcnJvcik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdG9MYXJnZUZpbGVzLmxlbmd0aCA+IDAgP1xyXG4gICAgICAgICAgICAgICAgICAgIHsnZmlsZVNpemUnOiB0b0xhcmdlRmlsZXN9IDogbnVsbDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ29tcGFyZSB0aGUgRmlsZSBzaXplIGluIGJ5dGVzIHdpdGggbWF4IGFuZCBtaW4gc2l6ZSBsaW1pdHNcclxuICAgICAqIEBkeW5hbWljXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgc2l6ZVJhbmdlKHsgbWluU2l6ZSwgbWF4U2l6ZSB9OiB7IG1pblNpemU/OiBudW1iZXI7IG1heFNpemU/OiBudW1iZXIgfSk6IFZhbGlkYXRvckZuIHtcclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCB8IEZpbGVVcGxvYWRDb250cm9sKToge3NpemVSYW5nZTogQXJyYXk8VmFsaWRhdGlvbkVycm9ycz59ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZXM6IEFycmF5PEZpbGU+ID0gY29udHJvbC52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKElzTnVsbE9yRW1wdHkoZmlsZXMpKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgICAgIGNoZWNrVmFsdWVUeXBlKGZpbGVzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNpemVNaXNtYXRjaCA9IGZpbGVzLm1hcCgoZmlsZSkgPT4gY2hlY2tGaWxlU2l6ZShmaWxlLCBtYXhTaXplLCBtaW5TaXplKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGVycm9yKSA9PiBlcnJvcik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc2l6ZU1pc21hdGNoLmxlbmd0aCA+IDAgP1xyXG4gICAgICAgICAgICAgICAgICAgIHsnc2l6ZVJhbmdlJzogc2l6ZU1pc21hdGNofSA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHZhbGlkYXRvciB0aGF0IHJlcXVpcmVzIGNvbnRyb2wgdG8gaGF2ZSBsaW1pdCBvbiBmaWxlcyBudW1iZXJcclxuICAgICAqIEBkeW5hbWljXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZmlsZXNMaW1pdChudW1GaWxlczogbnVtYmVyKTogVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sIHwgRmlsZVVwbG9hZENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZXM6IEFycmF5PEZpbGU+ID0gY29udHJvbC52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKElzTnVsbE9yRW1wdHkoZmlsZXMpKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgICAgIGNoZWNrVmFsdWVUeXBlKGZpbGVzKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmaWxlcy5sZW5ndGggPiBudW1GaWxlcyA/XHJcbiAgICAgICAgICAgICAgICB7J2ZpbGVzTGltaXQnOiB7J21heCc6IG51bUZpbGVzLCAnYWN0dWFsJzogZmlsZXMubGVuZ3RofX0gOiBudWxsO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiB2YWxpZGF0b3IgdGhhdCByZXF1aXJlcyBjb250cm9sIHRvIGhhdmUgbGltaXQgb24gbWVkaWEgdHlwZXNcclxuICAgICAqXHJcbiAgICAgKiAjIyMjIyBBbGxvd2VkIG1lZGlhIHR5cGVzIGFyZVxyXG4gICAgICpcclxuICAgICAqIC0gZmlsZV9leHRlbnNpb24gLSBhIGZpbGUgZXh0ZW5zaW9uIHN0YXJ0aW5nIHdpdGggdGhlIFNUT1AgY2hhcmFjdGVyLFxyXG4gICAgICogZS5nOiAuZ2lmLCAuanBnLCAucG5nLCAuZG9jXHJcbiAgICAgKiAtIGF1ZGlvLyogLSAgICAgICAgQWxsIHNvdW5kIGZpbGVzIGFyZSBhY2NlcHRlZFxyXG4gICAgICogLSB2aWRlby8qIC0gICAgICAgIEFsbCB2aWRlbyBmaWxlcyBhcmUgYWNjZXB0ZWRcclxuICAgICAqIC0gaW1hZ2UvKiAtICAgICAgICBBbGwgaW1hZ2UgZmlsZXMgYXJlIGFjY2VwdGVkXHJcbiAgICAgKiAtIG1lZGlhX3R5cGUgLSAgICAgQSB2YWxpZCBtZWRpYSB0eXBlLCB3aXRoIG5vIHBhcmFtZXRlcnMuIExvb2sgYXQgW0lBTkEgTWVkaWEgVHlwZXNdKGh0dHBzOi8vd3d3LmlhbmEub3JnL2Fzc2lnbm1lbnRzL21lZGlhLXR5cGVzL21lZGlhLXR5cGVzLnhodG1sKSBmb3IgYSBjb21wbGV0ZSBsaXN0IG9mIHN0YW5kYXJkIG1lZGlhIHR5cGVzXHJcbiAgICAgKlxyXG4gICAgICogIyMjIyBFeGFtcGxlXHJcbiAgICAgKiBgRmlsZVVwbG9hZFZhbGlkYXRvcnMuYWNjZXB0KFtmaWxlX2V4dGVuc2lvbiwgYXVkaW8vKiwgdmlkZW8vKiwgaW1hZ2UvKiwgbWVkaWFfdHlwZV0pYFxyXG4gICAgICogQGR5bmFtaWNcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBhY2NlcHQoYWxsb3dlZEZpbGVUeXBlczogQXJyYXk8c3RyaW5nPikge1xyXG4gICAgICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sIHwgRmlsZVVwbG9hZENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZXM6IEFycmF5PEZpbGU+ID0gY29udHJvbC52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKElzTnVsbE9yRW1wdHkoZmlsZXMpKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgICAgIGNoZWNrVmFsdWVUeXBlKGZpbGVzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG5vdEFsbG93ZWRGaWxlcyA9IGZpbGVzLm1hcCgoZmlsZSkgPT4gY2hlY2tGaWxlVHlwZShmaWxlLCBhbGxvd2VkRmlsZVR5cGVzKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGVycm9yKSA9PiBlcnJvcik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbm90QWxsb3dlZEZpbGVzLmxlbmd0aCA+IDAgP1xyXG4gICAgICAgICAgICAgICAgeydmaWxlVHlwZXMnOiBub3RBbGxvd2VkRmlsZXN9IDogbnVsbDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=