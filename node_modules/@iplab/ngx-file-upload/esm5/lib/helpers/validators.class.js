import { __values } from "tslib";
import { IsNullOrEmpty } from './helpers.class';
import { FileUploadTypes } from './file-types.class';
/**
 * function used to check file size
 */
var checkFileSize = function (file, maxSize, minSize) {
    if (minSize === void 0) { minSize = 0; }
    return (!IsNullOrEmpty(maxSize) && file.size > maxSize) || file.size < minSize ?
        { maxSize: maxSize, minSize: minSize, actual: file.size, file: file } : null;
};
var ɵ0 = checkFileSize;
var getFileType = function (file, fileExtension) {
    var type = file.type;
    if (!IsNullOrEmpty(type)) {
        return type;
    }
    return FileUploadTypes[fileExtension];
};
var ɵ1 = getFileType;
var FILE_EXT_REG = /(^[.]\w*)$/m;
/**
 * function used to check file type
 *
 * #### allowedTypes
 * file_extension|audio/*|video/*|image/*|media_type
 */
var checkFileType = function (file, allowedTypes) {
    var e_1, _a;
    var fileExtension = file.name.split('.').pop().toLowerCase();
    var fileType = getFileType(file, fileExtension);
    try {
        for (var allowedTypes_1 = __values(allowedTypes), allowedTypes_1_1 = allowedTypes_1.next(); !allowedTypes_1_1.done; allowedTypes_1_1 = allowedTypes_1.next()) {
            var type = allowedTypes_1_1.value;
            var isValid = FILE_EXT_REG.test(type) ? type === "." + fileExtension : new RegExp(type).test(fileType);
            if (isValid) {
                return null;
            }
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (allowedTypes_1_1 && !allowedTypes_1_1.done && (_a = allowedTypes_1.return)) _a.call(allowedTypes_1);
        }
        finally { if (e_1) throw e_1.error; }
    }
    return { allowedTypes: allowedTypes, actual: file.type, file: file };
};
var ɵ2 = checkFileType;
var checkValueType = function (value) {
    if (!Array.isArray(value)) {
        throw Error("FormControl.setValue was provided with wrong argument type, " + value + " was provided instead Array<File>");
    }
};
var ɵ3 = checkValueType;
// @dynamic
var FileUploadValidators = /** @class */ (function () {
    function FileUploadValidators() {
    }
    /**
     * Validator that requires controls to have a file maximum size length.
     * Compare the File size in bytes
     * @dynamic
     */
    FileUploadValidators.fileSize = function (maxSize) {
        return function (control) {
            var files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            var toLargeFiles = files.map(function (file) { return checkFileSize(file, maxSize); })
                .filter(function (error) { return error; });
            return toLargeFiles.length > 0 ?
                { 'fileSize': toLargeFiles } : null;
        };
    };
    /**
     * Compare the File size in bytes with max and min size limits
     * @dynamic
     */
    FileUploadValidators.sizeRange = function (_a) {
        var minSize = _a.minSize, maxSize = _a.maxSize;
        return function (control) {
            var files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            var sizeMismatch = files.map(function (file) { return checkFileSize(file, maxSize, minSize); })
                .filter(function (error) { return error; });
            return sizeMismatch.length > 0 ?
                { 'sizeRange': sizeMismatch } : null;
        };
    };
    /**
     * validator that requires control to have limit on files number
     * @dynamic
     */
    FileUploadValidators.filesLimit = function (numFiles) {
        return function (control) {
            var files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            return files.length > numFiles ?
                { 'filesLimit': { 'max': numFiles, 'actual': files.length } } : null;
        };
    };
    /**
     * validator that requires control to have limit on media types
     *
     * ##### Allowed media types are
     *
     * - file_extension - a file extension starting with the STOP character,
     * e.g: .gif, .jpg, .png, .doc
     * - audio/* -        All sound files are accepted
     * - video/* -        All video files are accepted
     * - image/* -        All image files are accepted
     * - media_type -     A valid media type, with no parameters. Look at [IANA Media Types](https://www.iana.org/assignments/media-types/media-types.xhtml) for a complete list of standard media types
     *
     * #### Example
     * `FileUploadValidators.accept([file_extension, audio/*, video/*, image/*, media_type])`
     * @dynamic
     */
    FileUploadValidators.accept = function (allowedFileTypes) {
        return function (control) {
            var files = control.value;
            if (IsNullOrEmpty(files)) {
                return null;
            }
            checkValueType(files);
            var notAllowedFiles = files.map(function (file) { return checkFileType(file, allowedFileTypes); })
                .filter(function (error) { return error; });
            return notAllowedFiles.length > 0 ?
                { 'fileTypes': notAllowedFiles } : null;
        };
    };
    return FileUploadValidators;
}());
export { FileUploadValidators };
export { ɵ0, ɵ1, ɵ2, ɵ3 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdG9ycy5jbGFzcy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BpcGxhYi9uZ3gtZmlsZS11cGxvYWQvIiwic291cmNlcyI6WyJsaWIvaGVscGVycy92YWxpZGF0b3JzLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFaEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBVXJEOztHQUVHO0FBQ0gsSUFBTSxhQUFhLEdBQUcsVUFBQyxJQUFVLEVBQUUsT0FBZSxFQUFFLE9BQW1CO0lBQW5CLHdCQUFBLEVBQUEsV0FBbUI7SUFDbkUsT0FBTyxDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsQ0FBQztRQUM1RSxFQUFDLE9BQU8sU0FBQSxFQUFFLE9BQU8sU0FBQSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksTUFBQSxFQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztBQUMzRCxDQUFDLENBQUM7O0FBRUYsSUFBTSxXQUFXLEdBQUcsVUFBQyxJQUFVLEVBQUUsYUFBcUI7SUFDbEQsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN2QixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ3RCLE9BQU8sSUFBdUIsQ0FBQztLQUNsQztJQUVELE9BQU8sZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzFDLENBQUMsQ0FBQzs7QUFFRixJQUFNLFlBQVksR0FBRyxhQUFhLENBQUM7QUFDbkM7Ozs7O0dBS0c7QUFDSCxJQUFNLGFBQWEsR0FBRyxVQUFDLElBQVUsRUFBRSxZQUEyQjs7SUFDMUQsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FB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Q0FBQyxLQUFLLENBQUM7WUFDekMsSUFBSSxhQUFhLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQUUsT0FBTyxJQUFJLENBQUM7YUFBRTtZQUMxQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFdEIsT0FBTyxLQUFLLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxDQUFDO2dCQUM1QixFQUFDLFlBQVksRUFBRSxFQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDekUsQ0FBQyxDQUFDO0lBQ04sQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7Ozs7T0FlRztJQUNXLDJCQUFNLEdBQXBCLFVBQXFCLGdCQUErQjtRQUNoRCxPQUFPLFVBQUMsT0FBNEM7WUFDaEQsSUFBTSxLQUFLLEdBQWdCLE9BQU8sQ0FBQyxLQUFLLENBQUM7WUFDekMsSUFBSSxhQUFhLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQUUsT0FBTyxJQUFJLENBQUM7YUFBRTtZQUMxQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFdEIsSUFBTSxlQUFlLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLGFBQWEsQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsRUFBckMsQ0FBcUMsQ0FBQztpQkFDckQsTUFBTSxDQUFDLFVBQUMsS0FBSyxJQUFLLE9BQUEsS0FBSyxFQUFMLENBQUssQ0FBQyxDQUFDO1lBRXRELE9BQU8sZUFBZSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDL0IsRUFBQyxXQUFXLEVBQUUsZUFBZSxFQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUM5QyxDQUFDLENBQUM7SUFDTixDQUFDO0lBRUwsMkJBQUM7QUFBRCxDQUFDLEFBcEZELElBb0ZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBJc051bGxPckVtcHR5IH0gZnJvbSAnLi9oZWxwZXJzLmNsYXNzJztcclxuaW1wb3J0IHsgRmlsZVVwbG9hZENvbnRyb2wgfSBmcm9tICcuL2NvbnRyb2wuY2xhc3MnO1xyXG5pbXBvcnQgeyBGaWxlVXBsb2FkVHlwZXMgfSBmcm9tICcuL2ZpbGUtdHlwZXMuY2xhc3MnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uRXJyb3JzIHtcclxuICAgIFtrZXk6IHN0cmluZ106IGFueTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0b3JGbiB7XHJcbiAgICAoYzogQWJzdHJhY3RDb250cm9sIHwgRmlsZVVwbG9hZENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIGZ1bmN0aW9uIHVzZWQgdG8gY2hlY2sgZmlsZSBzaXplXHJcbiAqL1xyXG5jb25zdCBjaGVja0ZpbGVTaXplID0gKGZpbGU6IEZpbGUsIG1heFNpemU6IG51bWJlciwgbWluU2l6ZTogbnVtYmVyID0gMCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcclxuICAgIHJldHVybiAoIUlzTnVsbE9yRW1wdHkobWF4U2l6ZSkgJiYgZmlsZS5zaXplID4gbWF4U2l6ZSkgfHwgZmlsZS5zaXplIDwgbWluU2l6ZSA/XHJcbiAgICAgICAge21heFNpemUsIG1pblNpemUsIGFjdHVhbDogZmlsZS5zaXplLCBmaWxlfSA6IG51bGw7XHJcbn07XHJcblxyXG5jb25zdCBnZXRGaWxlVHlwZSA9IChmaWxlOiBGaWxlLCBmaWxlRXh0ZW5zaW9uOiBzdHJpbmcpOiBGaWxlVXBsb2FkVHlwZXMgPT4ge1xyXG4gICAgY29uc3QgdHlwZSA9IGZpbGUudHlwZTtcclxuICAgIGlmICghSXNOdWxsT3JFbXB0eSh0eXBlKSkge1xyXG4gICAgICAgIHJldHVybiB0eXBlIGFzIEZpbGVVcGxvYWRUeXBlcztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gRmlsZVVwbG9hZFR5cGVzW2ZpbGVFeHRlbnNpb25dO1xyXG59O1xyXG5cclxuY29uc3QgRklMRV9FWFRfUkVHID0gLyheWy5dXFx3KikkL207XHJcbi8qKlxyXG4gKiBmdW5jdGlvbiB1c2VkIHRvIGNoZWNrIGZpbGUgdHlwZVxyXG4gKlxyXG4gKiAjIyMjIGFsbG93ZWRUeXBlc1xyXG4gKiBmaWxlX2V4dGVuc2lvbnxhdWRpby8qfHZpZGVvLyp8aW1hZ2UvKnxtZWRpYV90eXBlXHJcbiAqL1xyXG5jb25zdCBjaGVja0ZpbGVUeXBlID0gKGZpbGU6IEZpbGUsIGFsbG93ZWRUeXBlczogQXJyYXk8c3RyaW5nPik6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcclxuICAgIGNvbnN0IGZpbGVFeHRlbnNpb24gPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgY29uc3QgZmlsZVR5cGUgPSBnZXRGaWxlVHlwZShmaWxlLCBmaWxlRXh0ZW5zaW9uKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IHR5cGUgb2YgYWxsb3dlZFR5cGVzICkge1xyXG4gICAgICAgIGNvbnN0IGlzVmFsaWQgPSBGSUxFX0VYVF9SRUcudGVzdCh0eXBlKSA/IHR5cGUgPT09IGAuJHtmaWxlRXh0ZW5zaW9ufWAgOiBuZXcgUmVnRXhwKHR5cGUpLnRlc3QoZmlsZVR5cGUpO1xyXG4gICAgICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge2FsbG93ZWRUeXBlcywgYWN0dWFsOiBmaWxlLnR5cGUsIGZpbGV9O1xyXG59O1xyXG5cclxuY29uc3QgY2hlY2tWYWx1ZVR5cGUgPSAodmFsdWU6IGFueSApOiB2b2lkID0+IHtcclxuICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICB0aHJvdyBFcnJvcihgRm9ybUNvbnRyb2wuc2V0VmFsdWUgd2FzIHByb3ZpZGVkIHdpdGggd3JvbmcgYXJndW1lbnQgdHlwZSwgJHt2YWx1ZX0gd2FzIHByb3ZpZGVkIGluc3RlYWQgQXJyYXk8RmlsZT5gKTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkeW5hbWljXHJcbmV4cG9ydCBjbGFzcyBGaWxlVXBsb2FkVmFsaWRhdG9ycyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBWYWxpZGF0b3IgdGhhdCByZXF1aXJlcyBjb250cm9scyB0byBoYXZlIGEgZmlsZSBtYXhpbXVtIHNpemUgbGVuZ3RoLlxyXG4gICAgICogQ29tcGFyZSB0aGUgRmlsZSBzaXplIGluIGJ5dGVzXHJcbiAgICAgKiBAZHluYW1pY1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZpbGVTaXplKG1heFNpemU6IG51bWJlcik6IFZhbGlkYXRvckZuIHtcclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCB8IEZpbGVVcGxvYWRDb250cm9sKToge2ZpbGVTaXplOiBBcnJheTxWYWxpZGF0aW9uRXJyb3JzPn0gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlczogQXJyYXk8RmlsZT4gPSBjb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoSXNOdWxsT3JFbXB0eShmaWxlcykpIHsgcmV0dXJuIG51bGw7IH1cclxuICAgICAgICAgICAgY2hlY2tWYWx1ZVR5cGUoZmlsZXMpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdG9MYXJnZUZpbGVzID0gZmlsZXMubWFwKChmaWxlKSA9PiBjaGVja0ZpbGVTaXplKGZpbGUsIG1heFNpemUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoZXJyb3IpID0+IGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0b0xhcmdlRmlsZXMubGVuZ3RoID4gMCA/XHJcbiAgICAgICAgICAgICAgICAgICAgeydmaWxlU2l6ZSc6IHRvTGFyZ2VGaWxlc30gOiBudWxsO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb21wYXJlIHRoZSBGaWxlIHNpemUgaW4gYnl0ZXMgd2l0aCBtYXggYW5kIG1pbiBzaXplIGxpbWl0c1xyXG4gICAgICogQGR5bmFtaWNcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBzaXplUmFuZ2UoeyBtaW5TaXplLCBtYXhTaXplIH06IHsgbWluU2l6ZT86IG51bWJlcjsgbWF4U2l6ZT86IG51bWJlciB9KTogVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sIHwgRmlsZVVwbG9hZENvbnRyb2wpOiB7c2l6ZVJhbmdlOiBBcnJheTxWYWxpZGF0aW9uRXJyb3JzPn0gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlczogQXJyYXk8RmlsZT4gPSBjb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoSXNOdWxsT3JFbXB0eShmaWxlcykpIHsgcmV0dXJuIG51bGw7IH1cclxuICAgICAgICAgICAgY2hlY2tWYWx1ZVR5cGUoZmlsZXMpO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2l6ZU1pc21hdGNoID0gZmlsZXMubWFwKChmaWxlKSA9PiBjaGVja0ZpbGVTaXplKGZpbGUsIG1heFNpemUsIG1pblNpemUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoZXJyb3IpID0+IGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzaXplTWlzbWF0Y2gubGVuZ3RoID4gMCA/XHJcbiAgICAgICAgICAgICAgICAgICAgeydzaXplUmFuZ2UnOiBzaXplTWlzbWF0Y2h9IDogbnVsbDtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogdmFsaWRhdG9yIHRoYXQgcmVxdWlyZXMgY29udHJvbCB0byBoYXZlIGxpbWl0IG9uIGZpbGVzIG51bWJlclxyXG4gICAgICogQGR5bmFtaWNcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBmaWxlc0xpbWl0KG51bUZpbGVzOiBudW1iZXIpOiBWYWxpZGF0b3JGbiB7XHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wgfCBGaWxlVXBsb2FkQ29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlczogQXJyYXk8RmlsZT4gPSBjb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoSXNOdWxsT3JFbXB0eShmaWxlcykpIHsgcmV0dXJuIG51bGw7IH1cclxuICAgICAgICAgICAgY2hlY2tWYWx1ZVR5cGUoZmlsZXMpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZpbGVzLmxlbmd0aCA+IG51bUZpbGVzID9cclxuICAgICAgICAgICAgICAgIHsnZmlsZXNMaW1pdCc6IHsnbWF4JzogbnVtRmlsZXMsICdhY3R1YWwnOiBmaWxlcy5sZW5ndGh9fSA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHZhbGlkYXRvciB0aGF0IHJlcXVpcmVzIGNvbnRyb2wgdG8gaGF2ZSBsaW1pdCBvbiBtZWRpYSB0eXBlc1xyXG4gICAgICpcclxuICAgICAqICMjIyMjIEFsbG93ZWQgbWVkaWEgdHlwZXMgYXJlXHJcbiAgICAgKlxyXG4gICAgICogLSBmaWxlX2V4dGVuc2lvbiAtIGEgZmlsZSBleHRlbnNpb24gc3RhcnRpbmcgd2l0aCB0aGUgU1RPUCBjaGFyYWN0ZXIsXHJcbiAgICAgKiBlLmc6IC5naWYsIC5qcGcsIC5wbmcsIC5kb2NcclxuICAgICAqIC0gYXVkaW8vKiAtICAgICAgICBBbGwgc291bmQgZmlsZXMgYXJlIGFjY2VwdGVkXHJcbiAgICAgKiAtIHZpZGVvLyogLSAgICAgICAgQWxsIHZpZGVvIGZpbGVzIGFyZSBhY2NlcHRlZFxyXG4gICAgICogLSBpbWFnZS8qIC0gICAgICAgIEFsbCBpbWFnZSBmaWxlcyBhcmUgYWNjZXB0ZWRcclxuICAgICAqIC0gbWVkaWFfdHlwZSAtICAgICBBIHZhbGlkIG1lZGlhIHR5cGUsIHdpdGggbm8gcGFyYW1ldGVycy4gTG9vayBhdCBbSUFOQSBNZWRpYSBUeXBlc10oaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvbWVkaWEtdHlwZXMueGh0bWwpIGZvciBhIGNvbXBsZXRlIGxpc3Qgb2Ygc3RhbmRhcmQgbWVkaWEgdHlwZXNcclxuICAgICAqXHJcbiAgICAgKiAjIyMjIEV4YW1wbGVcclxuICAgICAqIGBGaWxlVXBsb2FkVmFsaWRhdG9ycy5hY2NlcHQoW2ZpbGVfZXh0ZW5zaW9uLCBhdWRpby8qLCB2aWRlby8qLCBpbWFnZS8qLCBtZWRpYV90eXBlXSlgXHJcbiAgICAgKiBAZHluYW1pY1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFjY2VwdChhbGxvd2VkRmlsZVR5cGVzOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wgfCBGaWxlVXBsb2FkQ29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlczogQXJyYXk8RmlsZT4gPSBjb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoSXNOdWxsT3JFbXB0eShmaWxlcykpIHsgcmV0dXJuIG51bGw7IH1cclxuICAgICAgICAgICAgY2hlY2tWYWx1ZVR5cGUoZmlsZXMpO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgbm90QWxsb3dlZEZpbGVzID0gZmlsZXMubWFwKChmaWxlKSA9PiBjaGVja0ZpbGVUeXBlKGZpbGUsIGFsbG93ZWRGaWxlVHlwZXMpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoZXJyb3IpID0+IGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBub3RBbGxvd2VkRmlsZXMubGVuZ3RoID4gMCA/XHJcbiAgICAgICAgICAgICAgICB7J2ZpbGVUeXBlcyc6IG5vdEFsbG93ZWRGaWxlc30gOiBudWxsO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==